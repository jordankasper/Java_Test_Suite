case $(uname) in
  Darwin)
    TEST_CONF_ROOT=$(dirname $(perl -e 'use Cwd "abs_path"; print abs_path(shift)' ${BASH_SOURCE[0]}))
    ;;
  *)
    TEST_CONF_ROOT=$(dirname "$(realpath ${BASH_SOURCE[0]})")
    ;;
esac

echo "conf/testenv: TEST_CONF_ROOT = $TEST_CONF_ROOT"

case "$1" in
	"java")
		if [[ ! -f "${TEST_CONF_ROOT}/java_local_config.yml" ]]; then
		   echo "conf/testenv: unable to find local config, please create one from the template: conf/java_local_config.yml.example"
		else
                    DNAME=`dirname "${TEST_CONF_ROOT}"`
                    echo "conf/testenv: DNAME = $DNAME"
		    source "${DNAME}/bin/activate"
			export PYTHONPATH="${DNAME}/src"
			export TEST_CONFIG=${TEST_CONF_ROOT}/java_config.yml
			export TEST_LOCAL_CONFIG=${TEST_CONF_ROOT}/java_local_config.yml
			export PATH=$HOME/apps/jdk1.6.0_31/bin:$HOME/agent_integration_tests/bin:$HOME/java_agent/agent-integration-tests/bin:/usr/local/bin:/usr/bin:/bin

			echo "conf/testenv: Java environment:"
			echo "PYTHONPATH: ${PYTHONPATH}"
			echo "TEST_CONFIG: ${TEST_CONFIG}"
			echo "TEST_LOCAL_CONFIG: ${TEST_LOCAL_CONFIG}"
			echo "PATH: ${PATH}"
		fi
		;;
	*)
		echo "conf/testenv: unknown env type: $1"
		;;
esac

unset TEST_CONF_ROOT
